{"version":3,"file":"styles.js","names":["FORMAT_ID_STARTS_FROM","initStyles","defaultFontFamily","fontFamily","defaultFontSize","fontSize","customFont","Boolean","undefined","formats","formatsIndex","styles","stylesIndex","fonts","fontsIndex","fills","fillsIndex","borders","bordersIndex","push","size","family","custom","left","right","top","bottom","gray125","getStyle","fontWeight","fontStyle","align","alignVertical","wrap","color","backgroundColor","borderColor","borderStyle","leftBorderColor","leftBorderStyle","rightBorderColor","rightBorderStyle","topBorderColor","topBorderStyle","bottomBorderColor","bottomBorderStyle","format","border","fontKey","fillKey","borderKey","key","styleId","formatId","String","length","fontId","weight","style","fillId","borderId","getStylesXml","generateXml","xml","i","$attr","font","getColor","fill","getBorderXml","direction","hasChildren","cellStyle","filter","_","join","Error","slice","toUpperCase"],"sources":["../../source/write/styles.js"],"sourcesContent":["import $attr from '../xml/sanitizeAttributeValue.js'\r\n\r\n// There seem to be about 100 \"built-in\" formats in Excel.\r\n// https://docs.microsoft.com/en-us/previous-versions/office/developer/office-2010/ee857658(v=office.14)?redirectedfrom=MSDN\r\nconst FORMAT_ID_STARTS_FROM = 100\r\n\r\nexport default function initStyles({\r\n  fontFamily: defaultFontFamily,\r\n  fontSize: defaultFontSize\r\n}) {\r\n  const customFont = Boolean(defaultFontFamily || defaultFontSize)\r\n\r\n  if (defaultFontFamily === undefined) {\r\n    defaultFontFamily = 'Calibri'\r\n  }\r\n\r\n  if (defaultFontSize === undefined) {\r\n    defaultFontSize = 12\r\n  }\r\n\r\n  const formats = []\r\n  const formatsIndex = {}\r\n\r\n  const styles = []\r\n  const stylesIndex = {}\r\n\r\n  const fonts = []\r\n  const fontsIndex = {}\r\n\r\n  const fills = []\r\n  const fillsIndex = {}\r\n\r\n  const borders = []\r\n  const bordersIndex = {}\r\n\r\n  // Default font.\r\n  fonts.push({\r\n    size: defaultFontSize,\r\n    family: defaultFontFamily,\r\n    custom: customFont\r\n  })\r\n  fontsIndex['-:-'] = 0\r\n\r\n  // Default fill.\r\n  fills.push({})\r\n  fillsIndex['-'] = 0\r\n\r\n  // Default border.\r\n  borders.push({\r\n    left: {},\r\n    right: {},\r\n    top: {},\r\n    bottom: {}\r\n  })\r\n  bordersIndex['-:-/-:-/-:-/-:-'] = 0\r\n\r\n  // \"gray125\" fill.\r\n  // For some weird reason, MS Office 2007 Excel seems to require that to be present.\r\n  // Otherwise, if absent, it would replace the first `backgroundColor`.\r\n  fills.push({\r\n    gray125: true\r\n  })\r\n\r\n  function getStyle({\r\n    fontFamily,\r\n    fontSize,\r\n    fontWeight,\r\n    fontStyle,\r\n    align,\r\n    alignVertical,\r\n    wrap,\r\n    color,\r\n    backgroundColor,\r\n    borderColor,\r\n    borderStyle,\r\n    leftBorderColor,\r\n    leftBorderStyle,\r\n    rightBorderColor,\r\n    rightBorderStyle,\r\n    topBorderColor,\r\n    topBorderStyle,\r\n    bottomBorderColor,\r\n    bottomBorderStyle\r\n  }, {\r\n    format\r\n  }) {\r\n    // Custom borders aren't supported.\r\n    const border = undefined\r\n    // Look for an existing style.\r\n    const fontKey = `${fontFamily || '-'}:${fontSize || '-'}:${fontWeight || '-'}:${fontStyle || '-'}:${color || '-'}`\r\n    const fillKey = backgroundColor || '-'\r\n    const borderKey =\r\n      `${(topBorderColor || borderColor) || '-'}:${(topBorderStyle || borderStyle) || '-'}` +\r\n      '/' +\r\n      `${(rightBorderColor || borderColor) || '-'}:${(rightBorderStyle || borderStyle) || '-'}` +\r\n      '/' +\r\n      `${(bottomBorderColor || borderColor) || '-'}:${(bottomBorderStyle || borderStyle) || '-'}` +\r\n      '/' +\r\n      `${(leftBorderColor || borderColor) || '-'}:${(leftBorderStyle || borderStyle) || '-'}`\r\n    const key = `${align || '-'}/${alignVertical || '-'}/${format || '-'}/${wrap || '-'}/${fontKey}/${fillKey}/${borderKey}`\r\n    const styleId = stylesIndex[key]\r\n    if (styleId !== undefined) {\r\n      return styleId\r\n    }\r\n    // Create new style.\r\n    // Get format ID.\r\n    let formatId\r\n    if (format) {\r\n      formatId = formatsIndex[format]\r\n      if (formatId === undefined) {\r\n        formatId = formatsIndex[format] = String(FORMAT_ID_STARTS_FROM + formats.length)\r\n        formats.push(format)\r\n      }\r\n    }\r\n    // Get font ID.\r\n    let fontId = customFont ? 0 : undefined\r\n    if (fontFamily || fontSize || fontWeight || fontStyle || color) {\r\n      fontId = fontsIndex[fontKey]\r\n      if (fontId === undefined) {\r\n        fontId = fontsIndex[fontKey] = String(fonts.length)\r\n        fonts.push({\r\n          custom: true,\r\n          size: fontSize || defaultFontSize,\r\n          family: fontFamily || defaultFontFamily,\r\n          weight: fontWeight,\r\n          style: fontStyle,\r\n          color\r\n        })\r\n      }\r\n    }\r\n    // Get fill ID.\r\n    let fillId\r\n    if (backgroundColor) {\r\n      fillId = fillsIndex[fillKey]\r\n      if (fillId === undefined) {\r\n        fillId = fillsIndex[fillKey] = String(fills.length)\r\n        fills.push({\r\n          color: backgroundColor\r\n        })\r\n      }\r\n    }\r\n    // Get border ID.\r\n    let borderId\r\n    if (\r\n      borderColor ||\r\n      borderStyle ||\r\n      leftBorderColor ||\r\n      leftBorderStyle ||\r\n      rightBorderColor ||\r\n      rightBorderStyle ||\r\n      topBorderColor ||\r\n      topBorderStyle ||\r\n      bottomBorderColor ||\r\n      bottomBorderStyle\r\n    ) {\r\n      borderId = bordersIndex[borderKey]\r\n      if (borderId === undefined) {\r\n        borderId = bordersIndex[borderKey] = String(borders.length)\r\n        borders.push({\r\n          left: {\r\n            style: leftBorderStyle || borderStyle,\r\n            color: leftBorderColor || borderColor\r\n          },\r\n          right: {\r\n            style: rightBorderStyle || borderStyle,\r\n            color: rightBorderColor || borderColor\r\n          },\r\n          top: {\r\n            style: topBorderStyle || borderStyle,\r\n            color: topBorderColor || borderColor\r\n          },\r\n          bottom: {\r\n            style: bottomBorderStyle || borderStyle,\r\n            color: bottomBorderColor || borderColor\r\n          }\r\n        })\r\n      }\r\n    }\r\n    // Add a style.\r\n    styles.push({\r\n      fontId,\r\n      fillId,\r\n      borderId,\r\n      align,\r\n      alignVertical,\r\n      wrap,\r\n      formatId\r\n    })\r\n    return stylesIndex[key] = String(styles.length - 1)\r\n  }\r\n\r\n  // Add the default style.\r\n  getStyle({}, {})\r\n\r\n  return {\r\n    getStylesXml() {\r\n      return generateXml({ formats, styles, fonts, fills, borders })\r\n    },\r\n    getStyle\r\n  }\r\n}\r\n\r\nfunction generateXml({ formats, styles, fonts, fills, borders }) {\r\n  let xml = '<?xml version=\"1.0\" ?>'\r\n  xml += '<styleSheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">'\r\n\r\n  // Turns out, as weird as it sounds, the order of XML elements matters to MS Office Excel.\r\n  // https://social.msdn.microsoft.com/Forums/office/en-US/cc47ab65-dab7-4e32-b676-b641aa1e1411/how-to-validate-the-xlsx-that-i-generate?forum=oxmlsdk\r\n  // For example, previously this library was inserting `<cellXfs/>` before `<fonts/>`\r\n  // and that caused MS Office 2007 Excel to throw an error about the file being corrupt:\r\n  // \"Excel found unreadable content in '*.xlsx'. Do you want to recover the contents of this workbook?\"\r\n  // \"Excel was able to open the file by repairing or removing the unreadable content.\"\r\n  // \"Removed Part: /xl/styles.xml part with XML error.  (Styles) Load error. Line 1, column ...\"\r\n  // \"Repaired Records: Cell information from /xl/worksheets/sheet1.xml part\"\r\n\r\n  if (formats.length > 0) {\r\n    xml += `<numFmts count=\"${formats.length}\">`\r\n    for (let i = 0; i < formats.length; i++) {\r\n      xml += `<numFmt numFmtId=\"${FORMAT_ID_STARTS_FROM + i}\" formatCode=\"${$attr(formats[i])}\"/>`\r\n    }\r\n    xml += `</numFmts>`\r\n  }\r\n\r\n  xml += `<fonts count=\"${fonts.length}\">`\r\n  for (const font of fonts) {\r\n    const {\r\n      size,\r\n      family,\r\n      color,\r\n      weight,\r\n      style,\r\n      custom\r\n    } = font\r\n    xml += '<font>'\r\n    xml += `<sz val=\"${size}\"/>`\r\n    xml += `<color ${color ? 'rgb=\"' + $attr(getColor(color)) + '\"' : 'theme=\"1\"'}/>`\r\n    xml += `<name val=\"${$attr(family)}\"/>`\r\n    // It's not clear what the `<family/>` tag means or does.\r\n    // It seems to always be `<family val=\"2\"/>` even for different\r\n    // font families (Calibri, Arial, etc).\r\n    xml += '<family val=\"2\"/>'\r\n    //\r\n    // It's not clear what the `<scheme/>` tag means or does.\r\n    // Seems like it's only preset for the default \"Calibri\" font.\r\n    // Adding it to any other font resets the font family in Microsoft Excel 2007.\r\n    //\r\n    // \"Defines the font scheme, if any, to which this font belongs.\r\n    //  When a font definition is part of a theme definition, then the font\r\n    //  is categorized as either a \"major\" or \"minor\" font scheme component.\r\n    //  When a new theme is chosen, every font that is part of a theme definition\r\n    //  is updated to use the new \"major\" or \"minor\" font definition for that theme.\r\n    //  Usually \"major\" fonts are used for styles like headings,\r\n    //  and \"minor\" fonts are used for body and paragraph text.\"\r\n    //\r\n    // https://hackage.haskell.org/package/xlsx-0.8.4/docs/Codec-Xlsx-Types-StyleSheet.html\r\n    //\r\n    if (!custom) {\r\n      xml += '<scheme val=\"minor\"/>'\r\n    }\r\n    if (weight === 'bold') {\r\n      xml += '<b/>'\r\n    }\r\n    if (style === 'italic') {\r\n      xml += '<i/>'\r\n    }\r\n    xml += '</font>'\r\n  }\r\n  xml += '</fonts>'\r\n\r\n  // MS Office 2007 Excel seems to require a `<fills/>` element to exist.\r\n  // without it, MS Office 2007 Excel thinks that the file is broken.\r\n  xml += `<fills count=\"${fills.length}\">`\r\n  for (const fill of fills) {\r\n    const { color, gray125 } = fill\r\n    xml += '<fill>'\r\n    if (color) {\r\n      xml += '<patternFill patternType=\"solid\">'\r\n      xml += `<fgColor rgb=\"${$attr(getColor(color))}\"/>`\r\n      // Whatever that could mean.\r\n      xml += '<bgColor indexed=\"64\"/>'\r\n      xml += '</patternFill>'\r\n    } else if (gray125) {\r\n      // \"gray125\" fill.\r\n      // For some weird reason, MS Office 2007 Excel seems to require that to be present.\r\n      // Otherwise, if absent, it would replace the first `backgroundColor`.\r\n      xml += '<patternFill patternType=\"gray125\"/>'\r\n    } else {\r\n      xml += '<patternFill patternType=\"none\"/>'\r\n    }\r\n    xml += '</fill>'\r\n  }\r\n  xml += '</fills>'\r\n\r\n  // MS Office 2007 Excel seems to require a `<borders/>` element to exist:\r\n  // without it, MS Office 2007 Excel thinks that the file is broken.\r\n  xml += `<borders count=\"${borders.length}\">`\r\n  for (const border of borders) {\r\n    const {\r\n      left,\r\n      right,\r\n      top,\r\n      bottom\r\n    } = border\r\n    const getBorderXml = (direction, { style, color }) => {\r\n      if (color && !style) {\r\n        style = 'thin'\r\n      }\r\n      const hasChildren = color ? true : false\r\n      return `<${direction}` +\r\n        (style ? ` style=\"${$attr(style)}\"` : '') +\r\n        (hasChildren ? '>' : '/>') +\r\n        (color ? `<color rgb=\"${$attr(getColor(color))}\"/>` : '') +\r\n        (hasChildren ? `</${direction}>` : '')\r\n    }\r\n    xml += '<border>'\r\n    xml += getBorderXml('left', left)\r\n    xml += getBorderXml('right', right)\r\n    xml += getBorderXml('top', top)\r\n    xml += getBorderXml('bottom', bottom)\r\n    xml += '<diagonal/>'\r\n    xml += '</border>'\r\n  }\r\n  xml += '</borders>'\r\n\r\n  // What are `<cellXfs/>` and `<cellStyleXfs/>`:\r\n  // http://officeopenxml.com/SSstyles.php\r\n  //\r\n  // `<cellStyleXfs/>` are referenced from `<cellXfs/>` as `<xf xfId=\"...\"/>`.\r\n  // `<cellStyleXfs/>` defines abstract \"cell styles\" that can be \"extended\"\r\n  // by \"cell styles\" defined by `<cellXfs/>` that can be applied to individual cells:\r\n  // 1. `<cellStyleXfs><xf .../></cellStyleXfs>`\r\n  // 2. `<cellXfs><xf xfId={cellStyleXfs.xf.index}/></cellXfs>`\r\n  // 3. `<c s={cellXfs.xf.index}/>`\r\n  // Seems like \"cell styles\" defined by `<cellXfs/>` have to reference\r\n  // some abstract \"cell styles\" defined by `<cellStyleXfs/>` by the spec.\r\n  // Otherwise, there would be no need to use `<cellStyleXfs/>` at all.\r\n  // The naming is ambiguous and weird. The whole scheme is needlessly redundant.\r\n\r\n  // xml += '<cellStyleXfs count=\"2\">'\r\n  // xml += '<xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\"/>'\r\n  // // `applyFont=\"1\"` means apply a custom font in this \"abstract\" \"cell style\"\r\n  // // rather than using a default font.\r\n  // // Seems like by default `applyFont` is `\"0\"` meaning that,\r\n  // // unless `\"1\"` is specified, it would ignore the `fontId` attribute.\r\n  // xml += '<xf numFmtId=\"0\" fontId=\"1\" applyFont=\"1\" fillId=\"0\" borderId=\"0\"/>'\r\n  // xml += '</cellStyleXfs>'\r\n\r\n  xml += `<cellXfs count=\"${styles.length}\">`\r\n  for (const cellStyle of styles) {\r\n    const {\r\n      fontId,\r\n      fillId,\r\n      borderId,\r\n      align,\r\n      alignVertical,\r\n      wrap,\r\n      formatId\r\n    } = cellStyle\r\n    // `applyNumberFormat=\"1\"` means \"apply the `numFmtId` attribute\".\r\n    // Seems like by default `applyNumberFormat` is `\"0\"` meaning that,\r\n    // unless `\"1\"` is specified, it would ignore the `numFmtId` attribute.\r\n    xml += '<xf ' +\r\n      [\r\n        formatId !== undefined ? `numFmtId=\"${formatId}\"` : undefined,\r\n        formatId !== undefined ? 'applyNumberFormat=\"1\"' : undefined,\r\n        fontId !== undefined ? `fontId=\"${fontId}\"` : undefined,\r\n        fontId !== undefined ? 'applyFont=\"1\"' : undefined,\r\n        fillId !== undefined ? `fillId=\"${fillId}\"` : undefined,\r\n        fillId !== undefined ? 'applyFill=\"1\"' : undefined,\r\n        borderId !== undefined ? `borderId=\"${borderId}\"` : undefined,\r\n        borderId !== undefined ? 'applyBorder=\"1\"' : undefined,\r\n        align || alignVertical || wrap ? 'applyAlignment=\"1\"' : undefined,\r\n        // 'xfId=\"0\"'\r\n      ].filter(_ => _).join(' ') +\r\n    '>' +\r\n      // Possible horizontal alignment values:\r\n      //  left, center, right, fill, justify, center_across, distributed.\r\n      // Possible vertical alignment values:\r\n      //  top, vcenter, bottom, vjustify, vdistributed.\r\n      // https://xlsxwriter.readthedocs.io/format.html#set_align\r\n      (align || alignVertical || wrap\r\n        ? '<alignment' +\r\n          (align ? ` horizontal=\"${$attr(align)}\"` : '') +\r\n          (alignVertical ? ` vertical=\"${$attr(alignVertical)}\"` : '') +\r\n          (wrap ? ` wrapText=\"1\"` : '') +\r\n          '/>'\r\n        : ''\r\n      ) +\r\n    '</xf>'\r\n  }\r\n  xml += `</cellXfs>`\r\n\r\n  xml += '</styleSheet>'\r\n\r\n  return xml\r\n}\r\n\r\nfunction getColor(color) {\r\n  if (color[0] !== '#') {\r\n    throw new Error(`Color \"${color}\" must start with a \"#\"`)\r\n  }\r\n  return `FF${color.slice('#'.length).toUpperCase()}`\r\n}"],"mappings":"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"}